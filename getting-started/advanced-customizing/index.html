<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.59.0" />
    <meta name="description" content="Official Docksal documentation website">


    
<link rel="shortcut icon" href="/images/favicon.png?1573324472" type="image/x-icon" />

    <title>Advanced Customizations :: Docksal Documentation</title>

    
    <link href="/docksal-book/css/nucleus.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/fontawesome-all.min.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/hybrid.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/featherlight.min.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/perfect-scrollbar.min.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/auto-complete.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/atom-one-dark-reasonable.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/theme.css?1573324472" rel="stylesheet">
    <link href="/docksal-book/css/hugo-theme.css?1573324472" rel="stylesheet">
    
      <link href="/docksal-book/css/theme-docksal.css?1573324472" rel="stylesheet">
    

    <script src="/docksal-book/js/jquery-3.3.1.min.js?1573324472"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
        
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','');</script>
    
    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id="
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

  </head>
  <body class="" data-url="/docksal-book/getting-started/advanced-customizing/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
    <img src="/images/docksal-horiz-white.svg" alt="Docksal logo">
</a>

    </div>
    
        <div class="searchboxed">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/docksal-book/introduction/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/introduction/">
          <b>1. </b>Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/introduction/about/" title="About This Training" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/introduction/about/">
          About This Training
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/introduction/prerequisites/" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/introduction/prerequisites/">
          Prerequisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/" title="Intro to Docker" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/">
          <b>2. </b>Intro to Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/" title="Docker Basics" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/">
          Docker Basics
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/overview/" title="What is Docker?" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/overview/">
          What is Docker?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/" title="How Docker Works" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/">
          How Docker Works
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/client/" title="Docker Client" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/client/">
          Docker Client
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/daemon/" title="Docker Daemon" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/daemon/">
          Docker Daemon
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/images/" title="Docker Images" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/images/">
          Docker Images
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/containers/" title="Docker Containers" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/containers/">
          Docker Containers
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/storage/" title="Docker Storage" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/storage/">
          Docker Storage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/storage/volumes/" title="Volumes" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/storage/volumes/">
          Volumes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/storage/bind-mounts/" title="Bind Mounts" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/storage/bind-mounts/">
          Bind Mounts
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/services/" title="Docker Services" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/services/">
          Docker Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/docker-basics/docker-components/registries/" title="Docker Registries" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/docker-basics/docker-components/registries/">
          Docker Registries
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/why-containerize/" title="Why Containerize?" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/why-containerize/">
          Why Containerize?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docker/beyond-docker/" title="Beyond Docker" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docker/beyond-docker/">
          Beyond Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docksal-book/intro-docksal/" title="Intro to Docksal" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docksal/">
          <b>3. </b>Intro to Docksal
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docksal/whats-docksal/" title="What&#39;s a Docksal" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docksal/whats-docksal/">
          What&#39;s a Docksal
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docksal/stacks/" title="Docksal Stacks" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docksal/stacks/">
          Docksal Stacks
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docksal/services/" title="Docksal Services" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docksal/services/">
          Docksal Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docksal/starter-kits/" title="Boilerplates and Starter-kits" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docksal/starter-kits/">
          Boilerplates and Starter-kits
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/intro-docksal/in-the-container/" title="What&#39;s in the Container?" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/intro-docksal/in-the-container/">
          What&#39;s in the Container?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docksal-book/getting-started/" title="Getting Started" class="dd-item 
        parent
        
        
        ">
      <a href="/docksal-book/getting-started/">
          <b>4. </b>Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/installing-docksal/prereqs/" title="Before Installing" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/getting-started/installing-docksal/prereqs/">
          Before Installing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/installing-docksal/installation/" title="Installation" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/getting-started/installing-docksal/installation/">
          Installation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/first-fin/" title="Starting the System" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/getting-started/first-fin/">
          Starting the System
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/new-project/" title="Beginning with a Boilerplate" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/getting-started/new-project/">
          Beginning with a Boilerplate
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/installing-drupal/" title="Installing a Drupal Site" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/getting-started/installing-drupal/">
          Installing a Drupal Site
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/customizing/" title="Customizing a Project" class="dd-item 
        
        
        
        ">
      <a href="/docksal-book/getting-started/customizing/">
          Customizing a Project
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/docksal-book/getting-started/advanced-customizing/" title="Advanced Customizations" class="dd-item 
        parent
        active
        
        ">
      <a href="/docksal-book/getting-started/advanced-customizing/">
          Advanced Customizations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/docksal/docksal"><i class='fab fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://jddoesdev.github.io/docksal-book/versions/"><i class='fas fa-list'></i> Versions</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <div style="text-align:center">
    
    <a class="github-button" href="https://github.com/docksal/docksal" data-icon="octicon-star" data-show-count="true" aria-label="Star docksal/docksal on GitHub">Star</a>

    
    <a class="github-button" href="https://github.com/docksal/docksal/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork docksal/docksal on GitHub">Fork</a>

    <p>Made with <i class="fas fa-heart"></i> from <a href="https://docksal.io"><i class="icon docksal"></i></a></p>
</div>

<script async defer src="https://buttons.github.io/buttons.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript">
 docsearch({
 apiKey: '656714d8c3d5f7138b76633780faf6ba',
 indexName: 'docksal',
 inputSelector: '#search-by',
 debug: false 
 });
     jQuery(document).ready(function() {
     

     jQuery('input').keydown(function (e) {
         
         if (e.which == '37' || e.which == '39') {
             e.stopPropagation();
         }
     });
 });
</script>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/docksal/docksal/edit/develop/docs/getting-started/advanced-customizing/_index.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/docksal-book/'>Modern Local Development With Docksal</a> > <a href='/docksal-book/getting-started/'>Getting Started</a> > Advanced Customizations
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#truly-making-a-project-custom">Truly Making a Project Custom</a>
<ul>
<li><a href="#project-1-configuring-to-match-production">Project 1: Configuring to Match Production</a></li>
<li><a href="#project-2-the-front-end-team-requires-a-specific-version-of-npm-and-nodejs">Project 2: The Front-end Team Requires a Specific Version of NPM and NodeJS</a></li>
<li><a href="#project-3-a-multi-server-project">Project 3: A Multi-server Project</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Advanced Customizations
            </h1>
          

        




	

<h2 id="truly-making-a-project-custom">Truly Making a Project Custom</h2>

<p>In the last section we customized a few things to change our domain name and the site name. In this section, we&rsquo;re going to show how to extend a stack, change versions of images, and even customize and extend Docksal images using a Dockerfile.</p>

<h3 id="project-1-configuring-to-match-production">Project 1: Configuring to Match Production</h3>

<p>For this project, we&rsquo;re going to use the following scenario:</p>


<div class="notices info" ><p>Your client has a site on Acquia using PHP 7.3. You know that the default Docksal Acquia stack uses PHP 7.2, but you want to match environments. How do you do this?</p>
</div>


<ol>
<li><p><strong>Choose the right stack</strong></p>

<p>We&rsquo;re going to start by configuring Docksal to use the Acquia stack. In your <code>docksal.env</code> file, find the line <code>DOCKSAL_STACK=pantheon</code> and change it to <code>DOCKSAL_STACK=acquia</code>.</p></li>

<li><p><strong>Configure the docroot</strong></p>

<p>Acquia projects require that the Drupal installation live in <code>docroot</code> instead of <code>web</code>. This is the default webroot for Docksal, but to remain verbose we&rsquo;re going to change the environment variable. Find the line <code>DOCROOT=web</code> and change it to <code>DOCROOT=docroot</code></p></li>

<li><p><strong>Update docroot and composer.json</strong></p>

<p>Since our projects have been using the <code>web</code> folder for the docroot so far, we need to rename it. This is most easily accomplished in an IDE or in your system&rsquo;s version of a file explorer, however you can do this on a macOS or Linux terminal by using the <code>mv</code> command. <code>mv web docroot</code>. In addition, we also need to update our <code>composer.json</code> file to point to the correct folders.</p>

<p>In <code>composer.json</code>, in the <code>extra.installer-paths</code> section, you need to change all instances of <code>web/</code> to <code>docroot/</code>. Example: <code>&quot;web/core&quot;: [&quot;type:drupal-core&quot;],</code> becomes <code>&quot;docroot/core&quot;: [&quot;type:drupal-core&quot;],</code></p></li>

<li><p><strong>Configure the PHP version</strong></p>

<p>The PHP version is defined in the <code>cli</code> service. The default image for the <code>cli</code> service is <code>docksal/cli:2.6-php7.2</code>. We can change this in <code>docksal.env</code> by adding the following variable: <code>CLI_IMAGE=docksal/cli:2.8-php7.3</code>. This is the latest version of this image tagged with PHP 7.3.</p>

<p>Inside <code>~/.docksal/stacks/services.yml</code> the <code>cli</code> section runs logic for the image version: <code>image: ${CLI_IMAGE:-docksal/cli:2.6-php7.2}</code> which checks to see if the <code>CLI_IMAGE</code> environment variable is set, and if not, uses the default.</p></li>

<li><p><strong>Update your project</strong></p>

<p>The easiest way to do this is to run <code>fin up</code>, however if you have not initialized your project yet, you should run <code>fin init</code>. For this exercise we&rsquo;re going to run <code>fin init</code>.</p></li>
</ol>

<p>Run <code>fin init</code> and watch as the images that aren&rsquo;t on your system are pulled down and your project spins up using PHP 7.3.x.</p>

<h3 id="project-2-the-front-end-team-requires-a-specific-version-of-npm-and-nodejs">Project 2: The Front-end Team Requires a Specific Version of NPM and NodeJS</h3>

<p>For this project, we&rsquo;re going to use the following scenario:</p>


<div class="notices info" ><p>The front-end team is using a theme that is shared across multiple projects as a starter-kit. In order to reduce compatibility errors, they have requested that the Docksal setup accounts for this by locking to a specific version of NodeJS and NPM so that they don&rsquo;t have to completely overhaul the NPM dependencies.</p>
</div>


<p>To accomplish this, we&rsquo;re going to do a couple of things in order to lock a version of NodeJS and NPM.</p>

<ol>
<li><p><strong>Lock the versions in a custom Dockerfile</strong></p>

<p>We&rsquo;re going to create a custom Dockerfile that extends the default <code>cli</code> image within our project.</p>

<ol>
<li>Create the Dockerfile at <code>.docksal/services/cli/Dockerfile</code></li>

<li><p>Extend the current image by starting the file with</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> docksal/cli:2.8-php7.3</span></code></pre></div>
<p>This tells Docksal that we&rsquo;re still going to use this image, but we&rsquo;re doing something more with it.</p></li>

<li><p>Change the Dockerfile user so that settings aren&rsquo;t changed as <code>root</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> docker</span></code></pre></div></li>

<li><p>Run commands that will install and lock the version of NodeJS and NPM.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">RUN</span> set -e; <span style="color:#ae81ff">\ </span><span style="color:#75715e"># Note the &#39;;&#39; and the &#39;\&#39;.</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e"># Initialize the user environment (this loads nvm)</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  . $HOME/.profile; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Install the necessary nodejs version and remove the unnecessary version</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  nvm install <span style="color:#ae81ff">8</span>.11.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  nvm alias default <span style="color:#ae81ff">8</span>.11.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  nvm use default; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Install packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  npm install -g npm@6.1.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Cleanup</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  nvm clear-cache <span style="color:#f92672">&amp;&amp;</span> npm cache clear --force; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Fix npm complaining about permissions and not being able to update</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  sudo rm -rf $HOME/.config</code></pre></div>
<p>Notice that every command in the <code>RUN</code> directive is followed with <code>; \</code> except the last line. This is because <code>RUN</code> directives are concatinated into a single line when run.</p>

<p>We&rsquo;re sourcing the <code>~/.profile</code> file and getting our NVM (Node Version Manager) alias early on so that we can choose our version. In this case, we&rsquo;re using 8.11.0. Following that, we set this version as our default.</p>

<p>Next, we install our locked version of NPM, clean up our caches, and then run some permission fixes, but we&rsquo;re not done yet.</p></li>

<li><p>Return control to the <code>root</code> user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker"><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> root</span></code></pre></div>
<p>Our completed Dockerfile should look like this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile">  FROM docksal/cli:2.8-php7.3<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  USER docker<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  <span style="color:#75715e"># Install additional global npm dependencies</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  RUN set -e; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#75715e"># Initialize the user environment (this loads nvm)</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      . $HOME/.profile; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#75715e"># Install the necessary nodejs version</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      nvm install <span style="color:#ae81ff">8</span>.11.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      nvm alias default <span style="color:#ae81ff">8</span>.11.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      nvm use default; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      nvm uninstall <span style="color:#ae81ff">10</span>.16.3; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#75715e"># Install packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      npm install -g npm@6.1.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#75715e"># Cleanup</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      nvm clear-cache <span style="color:#f92672">&amp;&amp;</span> npm cache clear --force; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      <span style="color:#75715e"># Fix npm complaining about permissions and not being able to update</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      sudo rm -rf $HOME/.config<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  USER root</code></pre></div></li>

<li><p><strong>Call the custom Dockerfile</strong></p>

<p>In <code>docksal.yml</code> we&rsquo;re going to define our <code>cli</code> service.</p>

<ol>
<li>Open <code>.docksal/docksal.yml</code></li>

<li><p>Add the following to the <code>cli:</code> section:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">cli:
  image: ${COMPOSE_PROJECT_NAME_SAFE}_cli
  build: ${PROJECT_ROOT}/.docksal/services/cli</code></pre></div>
<p>This names the image based on our project&rsquo;s name and then tells Docksal where to find the file we&rsquo;re going to build the new image from.</p></li>
</ol></li>

<li><p><strong>Update the project</strong></p>

<p>Instead of running <code>fin init</code> here, we&rsquo;re going to run <code>fin up</code>. Keep an eye on the output as the new image is built.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ fin up
Starting services...
Building cli
Step <span style="color:#ae81ff">1</span>/4 : FROM docksal/cli:2.8-php7.3
---&gt; bef7b0b7014f
Step <span style="color:#ae81ff">2</span>/4 : USER docker
---&gt; Using cache
---&gt; d563a10b8db0
Step <span style="color:#ae81ff">3</span>/4 : RUN set -e;   . $HOME/.profile;   nvm install <span style="color:#ae81ff">8</span>.11.0;   nvm alias default <span style="color:#ae81ff">8</span>.11.0;   nvm use default;   npm install -g npm@6.1.0;   nvm clear-cache <span style="color:#f92672">&amp;&amp;</span> npm cache clear --force;   sudo rm -rf $HOME/.config
---&gt; Running in d503e299f557
/bin/sh: <span style="color:#ae81ff">39</span>: /home/docker/.profile: <span style="color:#f92672">[[</span>: not found
Downloading and installing node v8.11.0...
Downloading https://nodejs.org/dist/v8.11.0/node-v8.11.0-linux-x64.tar.xz...
<span style="color:#75715e">######################################################################## 100.0%</span>
Computing checksum with sha256sum
Checksums matched!
Now using node v8.11.0 <span style="color:#f92672">(</span>npm v5.6.0<span style="color:#f92672">)</span>
default -&gt; <span style="color:#ae81ff">8</span>.11.0 <span style="color:#f92672">(</span>-&gt; v8.11.0<span style="color:#f92672">)</span>
Now using node v8.11.0 <span style="color:#f92672">(</span>npm v5.6.0<span style="color:#f92672">)</span>
Uninstalled node v10.16.3
/home/docker/.nvm/versions/node/v8.11.0/bin/npx -&gt; /home/docker/.nvm/versions/node/v8.11.0/lib/node_modules/npm/bin/npx-cli.js
/home/docker/.nvm/versions/node/v8.11.0/bin/npm -&gt; /home/docker/.nvm/versions/node/v8.11.0/lib/node_modules/npm/bin/npm-cli.js
+ npm@6.1.0
added <span style="color:#ae81ff">247</span> packages, removed <span style="color:#ae81ff">41</span> packages and updated <span style="color:#ae81ff">129</span> packages in <span style="color:#ae81ff">25</span>.413s
nvm cache cleared.
npm WARN using --force I sure hope you know what you are doing.
Removing intermediate container d503e299f557
---&gt; 4d9ec2ec20f4
Step <span style="color:#ae81ff">4</span>/4 : USER root
---&gt; Running in 70ebd3d709ff
Removing intermediate container 70ebd3d709ff
---&gt; 1c70700b6839
Successfully built 1c70700b6839
Successfully tagged my-first-docksal-project_cli:latest</code></pre></div>
<p>Every step in the Dockerfile is tagged in the image with a hash.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Step <span style="color:#ae81ff">1</span>/4 : FROM docksal/cli:2.8-php7.3
---&gt; bef7b0b7014f</code></pre></div>
<p>The hash <code>bef7b0b7014f</code> indicates a layer of the image. If something were to break when building the image, this gives us a point of reference to examine the image and see what happened. As you can see, our image built successfully and our system now has the correct versions of NodeJS and NPM installed. We can check this by running the following:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fin exec node -v
v8.11.0

$ fin exec npm -v
<span style="color:#ae81ff">6</span>.1.0</code></pre></div></li>
</ol>

<p>Now our front-end team has the version they need installed, and everyone is happy.</p>

<h3 id="project-3-a-multi-server-project">Project 3: A Multi-server Project</h3>

<p>For this lesson we&rsquo;re going to look at the following scenario:</p>


<div class="notices info" ><p>A client wants a decoupled solution to be hosted on two servers. The Drupal side will be hosted on Acquia and the front-end side will be hosted on a different server. The project is going to use GatsbyJS for the front-end.</p>
</div>


<p>Now, we can build off our last step</p></li>
</ol>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/docksal-book/getting-started/customizing/" title="Customizing a Project"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/docksal-book/getting-started/installing-docksal/prereqs/" title="Before Installing" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docksal-book/js/clipboard.min.js?1573324472"></script>
    <script src="/docksal-book/js/perfect-scrollbar.min.js?1573324472"></script>
    <script src="/docksal-book/js/perfect-scrollbar.jquery.min.js?1573324472"></script>
    <script src="/docksal-book/js/jquery.sticky.js?1573324472"></script>
    <script src="/docksal-book/js/featherlight.min.js?1573324472"></script>
    <script src="/docksal-book/js/highlight.pack.js?1573324472"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docksal-book/js/modernizr.custom-3.6.0.js?1573324472"></script>
    <script src="/docksal-book/js/learn.js?1573324472"></script>
    <script src="/docksal-book/js/hugo-learn.js?1573324472"></script>

    <link href="/docksal-book/mermaid/mermaid.css?1573324472" rel="stylesheet" />
    <script src="/docksal-book/mermaid/mermaid.js?1573324472"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
