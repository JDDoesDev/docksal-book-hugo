<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.59.1" />
    <meta name="description" content="Docksal training guide">


    
<link rel="shortcut icon" href="https://jddoesdev.github.io/docksal-training/images/favicon.png?1573495088" type="image/x-icon" />

    <title>Project 3: Building a Multi-server Project :: Docksal Documentation</title>

    
    <link href="https://jddoesdev.github.io/docksal-training/css/nucleus.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/fontawesome-all.min.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/hybrid.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/featherlight.min.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/perfect-scrollbar.min.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/auto-complete.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/atom-one-dark-reasonable.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/theme.css?1573495088" rel="stylesheet">
    <link href="https://jddoesdev.github.io/docksal-training/css/hugo-theme.css?1573495088" rel="stylesheet">
    
      <link href="https://jddoesdev.github.io/docksal-training/css/theme-docksal.css?1573495088" rel="stylesheet">
    

    <script src="https://jddoesdev.github.io/docksal-training/js/jquery-3.3.1.min.js?1573495088"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
        
    
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','');</script>
    
    
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id="
                      height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

  </head>
  <body class="" data-url="/going-further/advanced-customizing/project-3/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://jddoesdev.github.io/docksal-training/">
    <img src="https://jddoesdev.github.io/docksal-training/images/docksal-horiz-white.svg" alt="Docksal logo">
</a>

    </div>
    
        <div class="searchbox">
  <label for="search-by"><i class="fas fa-search"></i></label>
  <input data-search-input id="search-by" type="search" placeholder="Search...">
  <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://jddoesdev.github.io/docksal-training/js/lunr.min.js?1573495088"></script>
<script type="text/javascript" src="https://jddoesdev.github.io/docksal-training/js/auto-complete.js?1573495088"></script>
<script type="text/javascript">
  
      var baseurl = "https:\/\/jddoesdev.github.io\/docksal-training\/";
  
</script>
<script type="text/javascript" src="https://jddoesdev.github.io/docksal-training/js/search.js?1573495088"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/introduction/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/introduction/">
          <b>1. </b>Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/introduction/about/" title="About This Training" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/introduction/about/">
          About This Training
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/introduction/prerequisites/" title="Prerequisites" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/introduction/prerequisites/">
          Prerequisites
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/intro-docker/" title="Intro to Docker" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/">
          <b>2. </b>Intro to Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/" title="Docker Basics" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/">
          Docker Basics
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/overview/" title="What is Docker?" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/overview/">
          What is Docker?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/" title="How Docker Works" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/">
          How Docker Works
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/client/" title="Docker Client" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/client/">
          Docker Client
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/daemon/" title="Docker Daemon" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/daemon/">
          Docker Daemon
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/images/" title="Docker Images" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/images/">
          Docker Images
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/containers/" title="Docker Containers" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/containers/">
          Docker Containers
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/storage/" title="Docker Storage" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/storage/">
          Docker Storage
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/storage/volumes/" title="Volumes" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/storage/volumes/">
          Volumes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/storage/bind-mounts/" title="Bind Mounts" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/storage/bind-mounts/">
          Bind Mounts
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/services/" title="Docker Services" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/services/">
          Docker Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/docker-basics/docker-components/registries/" title="Docker Registries" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/docker-basics/docker-components/registries/">
          Docker Registries
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/why-containerize/" title="Why Containerize?" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/why-containerize/">
          Why Containerize?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docker/beyond-docker/" title="Beyond Docker" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docker/beyond-docker/">
          Beyond Docker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/intro-docksal/" title="Intro to Docksal" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docksal/">
          <b>3. </b>Intro to Docksal
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/intro-docksal/whats-docksal/" title="What&#39;s a Docksal" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docksal/whats-docksal/">
          What&#39;s a Docksal
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docksal/services/" title="Docksal Services" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docksal/services/">
          Docksal Services
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docksal/stacks/" title="Docksal Stacks" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docksal/stacks/">
          Docksal Stacks
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docksal/starter-kits/" title="Boilerplates and Starter-kits" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docksal/starter-kits/">
          Boilerplates and Starter-kits
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/intro-docksal/in-the-container/" title="What&#39;s in the Container?" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/intro-docksal/in-the-container/">
          What&#39;s in the Container?
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/getting-started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/getting-started/">
          <b>4. </b>Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/getting-started/installing-docksal/prereqs/" title="Before Installing" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/getting-started/installing-docksal/prereqs/">
          Before Installing
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/getting-started/installing-docksal/installation/" title="Installation" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/getting-started/installing-docksal/installation/">
          Installation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/getting-started/first-fin/" title="Starting the System" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/getting-started/first-fin/">
          Starting the System
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/getting-started/new-project/" title="Beginning with a Boilerplate" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/getting-started/new-project/">
          Beginning with a Boilerplate
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/getting-started/installing-drupal/" title="Installing a Drupal Site" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/getting-started/installing-drupal/">
          Installing a Drupal Site
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/going-further/" title="Going Further" class="dd-item 
        parent
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/going-further/">
          <b>5. </b>Going Further
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/going-further/customizing/" title="Customizing a Project" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/going-further/customizing/">
          Customizing a Project
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/going-further/advanced-customizing/" title="Advanced Customizations" class="dd-item 
        parent
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/">
          Advanced Customizations
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/going-further/advanced-customizing/project-1/" title="Project 1: Configuring to Match Production" class="dd-item ">
        <a href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/project-1/">
        Project 1: Configuring to Match Production
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/going-further/advanced-customizing/project-2/" title="Project 2: The Front-end Team Requires a Specific Version of NPM and NodeJS" class="dd-item ">
        <a href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/project-2/">
        Project 2: The Front-end Team Requires a Specific Version of NPM and NodeJS
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/going-further/advanced-customizing/project-3/" title="Project 3: Building a Multi-server Project" class="dd-item active">
        <a href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/project-3/">
        Project 3: Building a Multi-server Project
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/going-further/advanced-customizing/summary/" title="Summary" class="dd-item ">
        <a href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/summary/">
        Summary
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/going-further/keep-it-local/" title="Using Local Files" class="dd-item 
        
        
        
        ">
      <a href="https://jddoesdev.github.io/docksal-training/going-further/keep-it-local/">
          Using Local Files
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://docksal.io">Docksal Project</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/jddoesdev/docksal-training"><i class='fab fa-github'></i> Guide Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://docs.docksal.io">Official Docksal documentation</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='https://jddoesdev.github.io/docksal-training/'>Modern Local Development With Docksal</a> > <a href='https://jddoesdev.github.io/docksal-training/going-further/'>Going Further</a> > <a href='https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/'>Advanced Customizations</a> > Project 3: Building a Multi-server Project
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#scenario">Scenario</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Project 3: Building a Multi-server Project
            </h1>
          

        





<h3 id="scenario">Scenario</h3>

<p>For this lesson we&rsquo;re going to look at the following scenario:</p>


<div class="notices info" ><p>A client wants a decoupled solution to be hosted on two servers. The Drupal side will be hosted on Acquia and the front-end side will be hosted on a different server. The project is going to use GatsbyJS for the front-end.</p>
</div>


<p>Now, we can build off our last step by continuing to grow our <code>docksal.yml</code> and <code>docksal.env</code> files. We&rsquo;re also going to add in some custom commands to make our life a little bit easier in the long run.</p>

<p>Let&rsquo;s start off by listing what we&rsquo;re going to needing for this project:</p>

<ul>
<li>A Drupal installation on an Acquia Stack</li>
<li>Multiple domains</li>
<li>Two different simulated servers</li>
<li>The ability to connect the two servers</li>
<li>NodeJS</li>
<li>npm</li>
<li>Gatsby CLI</li>
</ul>

<p>Now, we could simulate the different servers by simply using multiple VirtualHosts in Apache, but that&rsquo;s not really simulating separate servers. Instead, it&rsquo;s using the same web server to host projects in different locations. To overcome this, we&rsquo;re going to simulate by keeping the Gatsby web server in its own service, separate from the Drupal site.</p>

<p>However, we can still use a shared codebase so that we only need to maintain a single git repo.</p>

<p>Let&rsquo;s get started:</p>

<ol>
<li><p><strong>Create a Custom Gatsby Service - Dockerfile</strong></p>

<p>To do this we&rsquo;re going to use both a custom Dockerfile and edit our <code>docksal.yml</code>. Let&rsquo;s begin by creating the custom Dockerfile.</p>

<ol>
<li>Create the file <code>.docksal/services/gatsby/Dockerfile</code></li>

<li><p>We&rsquo;re going to extend the default Docksal CLI image so start the file with:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> docksal/cli:2.9-php7.3</span></code></pre></div></li>

<li><p>We want to run all of our installations as our default container user &ldquo;docker&rdquo; so we need to make sure to switch users in the Dockerfile.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> docker</span></code></pre></div></li>

<li><p>Now we want to ensure that the commands run in Bash instead of the default shell. We need to tell the image to build that way.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">SHELL</span> [<span style="color:#e6db74">&#34;/bin/bash&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>]</code></pre></div>
<p>This tells Docker to build this layer of the image as though it were in a Bash shell. The flag <code>-c</code> tells it to get ready for the command.</p></li>

<li><p>This next section should look pretty familiar. We&rsquo;re going to tell the image to add in a locked version of NodeJS, a locked version of NPM, and this time we&rsquo;re adding in Gatsby CLI.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">RUN</span> set -e; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Initialize the user environment (this loads nvm)</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  source $HOME/.profile; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Install the necessary nodejs version</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  nvm install <span style="color:#ae81ff">10</span>.15.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  nvm alias default <span style="color:#ae81ff">10</span>.15.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  nvm use default; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Install packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  npm install -g npm@6.4.1; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  npm install -g gatsby-cli; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Cleanup</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  nvm clear-cache <span style="color:#f92672">&amp;&amp;</span> npm cache clear --force; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>  <span style="color:#75715e"># Fix npm complaining about permissions and not being able to update</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  sudo rm -rf $HOME/.config;</code></pre></div>
<p>The biggest changes here from our last project are that we&rsquo;re locking NodeJS at 10.15.0, we&rsquo;re installing npm 6.4.1, and we&rsquo;re installing Gatsby CLI.</p></li>

<li><p>We need to return to the default shell and switch back to the <code>root</code> user.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">SHELL</span> [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> root</span></code></pre></div>
<p>Just like our earlier <code>SHELL</code> directive, we&rsquo;re running the command to change back to <code>sh</code>, the default shell, and then switching to the <code>root</code> user for further commands.</p></li>

<li><p>Finally, we need to tell our service to expose the port that the development server for Gatsby runs on. In this case, <code>8000</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8000</span></code></pre></div></li>
</ol>

<p>The final Dockerfile should look like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dockerfile" data-lang="dockerfile"><span style="color:#66d9ef">FROM</span><span style="color:#e6db74"> docksal/cli:2.9-php7.3</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> docker</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">SHELL</span> [<span style="color:#e6db74">&#34;/bin/bash&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e"># Install additional global npm dependencies</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">RUN</span> set -e; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#75715e"># Initialize the user environment (this loads nvm)</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    source $HOME/.profile; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#75715e"># Install the necessary nodejs version</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    nvm install <span style="color:#ae81ff">10</span>.15.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    nvm alias default <span style="color:#ae81ff">10</span>.15.0; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    nvm use default; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#75715e"># Install packages</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    npm install -g npm@6.4.1; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    npm install -g gatsby-cli; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#75715e"># Cleanup</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    nvm clear-cache <span style="color:#f92672">&amp;&amp;</span> npm cache clear --force; <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>    <span style="color:#75715e"># Fix npm complaining about permissions and not being able to update</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    sudo rm -rf $HOME/.config;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">SHELL</span> [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">USER</span><span style="color:#e6db74"> root</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">EXPOSE</span><span style="color:#e6db74"> 8000</span></code></pre></div>
<p>Save the Dockerfile and close it out.</p></li>

<li><p><strong>Create a Custom Gatsby Service - <code>docksal.yml</code></strong></p>

<p>Now that we have our Dockerfile created, we need to tell Docksal to use it when putting together the application. For that, we need to open <code>.docksal/docksal.yml</code> and make some changes.</p>

<p>Remember, indentation matters in a YAML file.</p>

<ol>
<li><p>In our <code>docksal.yml</code> file we&rsquo;re going to define a new service. This will go under the parent <code>services</code> and should have the same indentation as our customized <code>cli</code> service. We&rsquo;re going to name this service <code>gatsby</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">version: <span style="color:#e6db74">&#34;2.1&#34;</span>
services:
  cli:
    ...
  gatsby:</code></pre></div></li>

<li><p>In order to function within our application, there are a few things that we need to pass to the <code>gatsby</code> service. The host user ID, the host group ID, and the DNS information. We can pass the host user and group IDs through the <code>environment</code> component and the DNS settings through the DNS component.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">gatsby:
  environment:
    - HOST_UID
    - HOST_GID
  dns:
    - ${DOCKSAL_DNS1}
    - ${DOCKSAL_DNS2}</code></pre></div>
<p>The <code>DOCKSAL_DNS1</code> and <code>DOCKSAL_DNS2</code> variables are defined in the <code>fin</code> binary based on the local IP address of the Docksal VM and the remote DNS server <code>8.8.8.8</code></p></li>

<li><p>Now we need to tell Docksal a little more about our service. We&rsquo;re going to do this by defining the hostname, the image name, and where to build the image from. We can do this by adding a few more items to our <code>docksal.yml</code>. For consistency with other services, we&rsquo;re going to place these immediately following the <code>gatsby:</code> declaration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">gatsby:
  hostname: gatsby
  image: ${COMPOSE_PROJECT_NAME_SAFE}_gatsby
  build: ${PROJECT_ROOT}/.docksal/services/gatsby
  environment: ...</code></pre></div>
<p>The hostname is what we can use to identify this service without having to type the entire service name out.</p>

<p>Also, notice that we did <em>not</em> include <code>Dockerfile</code> in our build. This is on purpose because Docker knows we&rsquo;re looking for a Dockerfile.</p></li>

<li><p>It&rsquo;s time to tell Docksal what domain to use for this service. We&rsquo;re going to do this by using <code>labels</code>. We&rsquo;ll be using the <code>io.docksal.virtual-host</code>, <code>io.docksal.virtual-port</code>, and <code>io.docksal.cert-name</code> labels for this.</p>

<p>One thing to note is that when we run the command to start the development server for Gatsby, it&rsquo;s going to start a NodeJS process so the domain will point directly to this service and load what is being served by NodeJS.</p>

<p>Add the following below your <code>build:</code> line:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">labels:
  - io.docksal.virtual-host=gatsby.${VIRTUAL_HOST}
  - io.docksal.virtual-port=<span style="color:#ae81ff">8000</span>
  - io.docksal.cert-name=${VIRTUAL_HOST_CERT_NAME:-none}</code></pre></div>
<p>These set the domain, which will be <code>gatsby.mycustomsite.docksal</code>, the port that this domain will point to, and the cert name if we want or need to simulate an SSL environment.</p></li>

<li><p>Next, we need to tell the service where it should look for files to mount a volume. We&rsquo;ll do this using <code>volumes:</code> and point specifically to the <code>gatsby</code> folder.</p>

<p>Below your <code>labels</code> put in the <code>volumes:</code> information</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">volumes:
    - ${PROJECT_ROOT}/gatsby:/var/www/gatsby
    - ${SSH_AUTH_SOCK:-docksal_ssh_agent}:${SSH_AUTH_SOCK:-/.ssh-agent}:ro</code></pre></div>
<p>We&rsquo;re pointing this service to create an unnamed volume mounted to our <code>gatsby</code> folder that will exist as <code>/var/www/gatsby</code> within the container. We&rsquo;re also passing along our SSH keys in case we need them for anything.</p></li>

<li><p>Now some final touches to make life easier. We&rsquo;re going to add in a <code>working_dir</code> that makes it easier for us to run commands in our container, and a little environment variable that allows for us to watch for file changes, which is very handy when working with something using any kind of live-reload functionality.</p>

<p>We do this because the NFS bind we&rsquo;re using for our volumes does <em>not</em> track file changes and send notifications. Instead, we&rsquo;re using <a href="https://www.npmjs.com/package/chokidar">Chokidar</a>, an NPM package that simulates filesystem events.</p>

<p>Add the following to your <code>docksal.yml</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">environment:
  - HOST_UID
  - HOST_GID
  - CHOKIDAR_USEPOLLING=<span style="color:#ae81ff">1</span> <span style="color:#75715e"># &lt;== New Line</span>
working_dir: /var/www/gatsby <span style="color:#75715e"># &lt;== New Line</span></code></pre></div>
<p>Our <code>docksal.env</code> should look like this now:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">version: <span style="color:#e6db74">&#34;2.1&#34;</span>
services:
  cli:
    image: ${COMPOSE_PROJECT_NAME_SAFE}_cli
    build: ${PROJECT_ROOT}/.docksal/services/cli
    environment:
      - COMPOSER_MEMORY_LIMIT
      - SITE_NAME
  gatsby:
    hostname: gatsby
    image: ${COMPOSE_PROJECT_NAME_SAFE}_gatsby
    build: ${PROJECT_ROOT}/.docksal/services/gatsby
    labels:
      - io.docksal.virtual-host=gatsby.${VIRTUAL_HOST}
      - io.docksal.virtual-port=<span style="color:#ae81ff">8000</span>
      - io.docksal.cert-name=${VIRTUAL_HOST_CERT_NAME:-none}
      - io.docksal.shell=bash
    volumes:
      - ${PROJECT_ROOT}/gatsby:/var/www/gatsby
      - ${SSH_AUTH_SOCK:-docksal_ssh_agent}:${SSH_AUTH_SOCK:-/.ssh-agent}:ro
    environment:
      - HOST_UID
      - HOST_GID
      - CHOKIDAR_USEPOLLING=<span style="color:#ae81ff">1</span>
    working_dir: /var/www/gatsby
    dns:
      - ${DOCKSAL_DNS1}
      - ${DOCKSAL_DNS2}</code></pre></div>
<p>But don&rsquo;t close it out yet. There&rsquo;s a bit more to do here.</p></li>
</ol></li>

<li><p><strong>Add a Custom Web Service for the Static Build</strong></p>

<p>In order to fully simulate a two server setup, we want to let our Gatsby static site have its very own web server. We&rsquo;re going to do this by creating a custom web service that will handle the requests to the static site and route them to the Gatsby service and volume.</p>

<ol>
<li><p>Start by creating another service in your <code>docksal.yml</code> file. Call it <code>gatsby_web</code>. This should be the same indentation as your other services.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  gatsby_web:</code></pre></div></li>

<li><p>We&rsquo;re going to use the <code>docksal/apache:2.4-2.3</code> image for this so let&rsquo;s add that image to our service.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">gatsby_web:
  image: docksal/apache:<span style="color:#ae81ff">2.4-2.3</span></code></pre></div></li>

<li><p>Next, tell Apache where to point the webserver by creating a volume for the server.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  gatsby_apache:
    image: docksal/apache:<span style="color:#ae81ff">2.4-2.3</span>
    volumes:
      - ${PROJECT_ROOT}/gatsby:/var/www/gatsby</code></pre></div></li>

<li><p>We need to set an environment variable to tell apache where the docroot of our project is, otherwise it defaults to <code>/var/www/docroot</code>. We&rsquo;ll set that next.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    environment:
      - APACHE_DOCUMENTROOT=/var/www/gatsby/public</code></pre></div></li>

<li><p>Finally, we&rsquo;re going to assign the domain using a label, much like we did with our <code>gatsby</code> service.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">    labels:
      - io.docksal.virtual-host=static.${VIRTUAL_HOST}</code></pre></div>
<p>Our new service should look like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">  gatsby_apache:
    image: docksal/apache:<span style="color:#ae81ff">2.4-2.3</span>
    volumes:
      - ${PROJECT_ROOT}/gatsby:/var/www/gatsby
    environment:
      - APACHE_DOCUMENTROOT=/var/www/gatsby/public
    labels:
      - io.docksal.virtual-host=static.${VIRTUAL_HOST}</code></pre></div>
<p>We are not going to cover building a decoupled project here, but to test this you could create an <code>index.html</code> inside the <code>gatsby\public</code> folder, run <code>fin project start</code> because <code>fin up</code> may not capture all of your changes, and visit <code>static.mycustomsite.docksal</code> to see it load.</p></li>
</ol></li>

<li><p><strong>Create a custom command to run commands inside our new service</strong></p>

<p>It should be noted that normal <code>fin exec</code> commands will not run anything inside this service. If you need to run a command in a custom <code>cli</code>-type service, you&rsquo;ll need to add a few things to the command or create a custom command. An example of this would be running <code>gatsby develop</code>. Also, running <code>fin bash</code> will not get you into the service. For both of these commands you need to tell Docksal which service you are addressing.</p>

<p>For <code>fin exec</code> we&rsquo;ll need the <code>--in</code> flag, and for <code>fin bash</code> we need to add the service name as an argument.</p>

<p>Example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fin exec --in<span style="color:#f92672">=</span>gatsby gatsby develop</code></pre></div>
<p>or</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fin bash gatsby</code></pre></div>
<p>If you run these commands now, you may notice some things. One, the <code>fin exec</code> example doesn&rsquo;t work, and two, the <code>fin bash</code> example gets you to a sh shell instead of bash.</p>

<p>By default, only the <code>cli</code> and <code>db</code> services have access to bash with <code>fin exec</code>. To get around this we need to wrap our commands with a few things. First we need to tell Docksal what user we want to run the commands as. Remember, when we created our Dockerfiles we created the user <code>docker</code>. Now we need to tell Docksal to run the command with this user and we do so by passing a variable to the command.</p>

<p>Example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ container_user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-u docker&#34;</span> fin exec --in<span style="color:#f92672">=</span>gatsby</code></pre></div>
<p>The <code>container_user</code> variable is used in the <code>fin</code> binary to add arguments to the Docker commands that make Docksal work, which is why it&rsquo;s <code>-u docker</code> and not just <code>docker</code>.</p>

<p>However, this does not give us access to the bash shell. What we need to do is tell Docksal to run this command in bash. We do that by actually executing the <code>bash</code> executable.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ container_user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-u docker&#34;</span> fin exec --in<span style="color:#f92672">=</span>gatsby bash -lc <span style="color:#e6db74">&#34;gatsby develop&#34;</span></code></pre></div>
<p>The command here is telling <code>fin</code> to <code>exec</code>ute, in the container <code>gatsby</code> the <code>bash</code> executable. We pass in the <code>-l</code> flag to act as though it were invoked by a login shell, which gives us access to the aliases and commands in the <code>.bash_profile</code> and the <code>-c</code> flag to let <code>bash</code> know that we&rsquo;re giving it a command to run. Finally, we&rsquo;re giving it the command <code>&quot;gatsby develop&quot;</code>.</p>

<p>This can be a bit unwieldy to type so we could create an alias for it, but to make it reusable for others who may be working on this project, we want to add it to the repo somehow. We can do this by defining a custom command.</p>

<ol>
<li><p>In your <code>.docksal/commands</code> folder create the file <code>gatsby-develop</code>. Go back to your project root, <code>~/projects/docksal-training-projects/</code>, and create this file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd .docksal/commands
$ touch gatsby-develop
$ chmod +x gatsby-develop</code></pre></div>
<p>In this example we create the file and then we make it executable by running <code>chmod +x</code>. This is necessary for it to run as a command, although Docksal is smart enough to try and fix it for you if you forget.</p></li>

<li><p>In your editor, open this file up and let&rsquo;s add some things to it.</p>

<p>Since it&rsquo;s a bash script, we need our shebang:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash</span></code></pre></div>
<p>We also need our command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">container_user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-u docker&#34;</span> fin exec --in<span style="color:#f92672">=</span>gatsby bash -lc <span style="color:#e6db74">&#34;gatsby develop&#34;</span></code></pre></div>
<p>Now save this file and go back to your project root.</p></li>

<li><p>Run the new command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fin gatsby-develop</code></pre></div>
<p>Docksal will now pass in the command to the service and attempt to run <code>gatsby develop</code>, however it will error because we never installed Gatsby in this exercise.</p></li>
</ol></li>

<li><p><strong>Create a command to shell into your <code>gatsby</code> service</strong></p>

<p>We also want an entry point so that we can run more than just one command. For our default <code>cli</code> service, we can just run <code>fin bash</code>, but that will not work for our custom <code>gatsby</code> service. Instead, we&rsquo;re going to create the <code>gatsby-bash</code> command.</p>

<ol>
<li><p>In your <code>.docksal/commands</code> folder create the file <code>gatsby-bash</code>.</p>

<p>Go back to your project root, <code>~/projects/docksal-training-projects/</code>, and create this file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cd .docksal/commands
$ touch gatsby-bash
$ chmod +x gatsby-bash</code></pre></div></li>

<li><p>In your editor, open this file up and create the command.</p>

<p>Since it&rsquo;s a bash script, we need our shebang:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/usr/bin/env bash</span></code></pre></div>
<p>We also need our command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">container_user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;-u docker&#34;</span> fin exec --in<span style="color:#f92672">=</span>gatsby bash -il</code></pre></div>
<p>This time we&rsquo;re not passing a command, but we&rsquo;re using the <code>-i</code> flag instead of the <code>-c</code> flag. The <code>-i</code> flag indicates that we want to run this as an interactive shell and we also want it to have all of the commands from our <code>.bash_profile</code> file.</p>

<p>Now save this file and go back to your project root.</p></li>

<li><p>From your project root run the new command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ fin gatsby-bash</code></pre></div>
<p>You will now be inside your service, able to run any commands available to your project.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker@gatsby:/var/www/gatsby$</code></pre></div>
<p>Remember, you can exit out of your service by running the <code>exit</code> command to get back to your host machine&rsquo;s command line.</p></li>
</ol></li>
</ol>


<div class="notices tip" ><p>The completed code for Project 3 can be found at <a href="https://github.com/JDDoesDev/docksal-training-projects/tree/adv-cust-project-3">https://github.com/JDDoesDev/docksal-training-projects/tree/adv-cust-project-3</a></p>
</div>



<footer class=" footline" >
	
</footer>


        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/project-2/" title="Project 2: The Front-end Team Requires a Specific Version of NPM and NodeJS"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="https://jddoesdev.github.io/docksal-training/going-further/advanced-customizing/summary/" title="Summary" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://jddoesdev.github.io/docksal-training/js/clipboard.min.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/perfect-scrollbar.min.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/perfect-scrollbar.jquery.min.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/jquery.sticky.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/featherlight.min.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/highlight.pack.js?1573495088"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://jddoesdev.github.io/docksal-training/js/modernizr.custom-3.6.0.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/learn.js?1573495088"></script>
    <script src="https://jddoesdev.github.io/docksal-training/js/hugo-learn.js?1573495088"></script>

    <link href="https://jddoesdev.github.io/docksal-training/mermaid/mermaid.css?1573495088" rel="stylesheet" />
    <script src="https://jddoesdev.github.io/docksal-training/mermaid/mermaid.js?1573495088"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

